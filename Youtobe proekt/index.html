<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop</title>

    <link rel="icon" type="image/png" href="img/favicon.png">
    <link rel="stylesheet" href="style.css">

    <!-- –°—Ç–∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ -->
    <link rel="stylesheet" href="components/Header/Header.css">
    <link rel="stylesheet" href="components/Products/Products.css">
    <link rel="stylesheet" href="components/Shopping/Shopping.css">
    <link rel="stylesheet" href="components/Footer/Footer.css">
</head>
<body>

    <!-- Header -->
    <div id="header"></div>

    <!-- SPA –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div id="spa-view"></div>

    <!-- Footer -->
    <div id="footer"></div>


    <!-- JS -->
    <script src="constants/catalog.js"></script>
    <script src="constants/root.js"></script>
    <script src="utils/localStorageUtil.js"></script>
    <script src="components/Header/Header.js"></script>
    <script src="components/Products/Products.js"></script>
    <script src="components/Shopping/Shopping.js"></script>
    <script src="components/Footer/Footer.js"></script>

    <!-- SPA -->
    <script>
        const pages = {
            home: `
                <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
                <p>–≠—Ç–æ –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–∞—à–µ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞.</p>
            `,

            catalog: `
                <div id="products"></div>
            `,

            favorites: `
                <h1>–ú–æ–∏ –∂–µ–ª–∞–Ω–∏—è</h1>
                <div id="fav-list"></div>
            `,

            profile: `
                <h1>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
                <div class="profile-box">
                    <img id="profile-avatar" src="" class="profile-avatar">
                    <input id="profile-name" placeholder="–ò–º—è" />
                    <button onclick="saveProfileData()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            `,

            cart: `
                <div id="shopping"></div>
            `
        };

        function renderPage(page) {
            const container = document.getElementById("spa-view");

            container.className = "page-enter";

            setTimeout(() => {
                container.innerHTML = pages[page];

                if (page === 'catalog') productsPage.render();
                if (page === 'cart') shoppingPage.render();
                if (page === 'profile') loadProfile();
                if (page === 'favorites') renderFavorites();

                container.className = "page-enter-active";
            }, 50);
        }

        renderPage("home"); // –°—Ç–∞—Ä—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    </script>

    <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
    <script>
        function saveProfileData() {
            const data = {
                name: document.getElementById("profile-name").value,
                avatar: "img/avatar.png"
            };
            localStorageUtil.saveProfile(data);
            alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!");
        }

        function loadProfile() {
            const p = localStorageUtil.getProfile();
            document.getElementById("profile-avatar").src = p.avatar;
            document.getElementById("profile-name").value = p.name;
        }
    </script>

    <!-- –ò–∑–±—Ä–∞–Ω–Ω–æ–µ -->
    <script>
        function toggleFav(id, el) {
            const added = localStorageUtil.toggleFavorite(id);
            el.style.color = added ? "red" : "gray";
        }

        function renderFavorites() {
            const fav = localStorageUtil.getFavorites();
            let html = "";

            CATALOG.forEach(item => {
                if (fav.includes(item.id)) {
                    html += `
                        <div class="fav-item">
                            <img src="${item.img}" class="fav-img">
                            <div class="fav-info">
                                <p>${item.name}</p>
                                <span>${item.price.toLocaleString()} so'm</span>
                            </div>
                        </div>
                    `;
                }
            });

            document.getElementById("fav-list").innerHTML =
                html || "<p style='opacity:0.6'>–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç üò¢</p>";
        }
    </script>

    <!-- –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ -->
    <script>
        function toggleTheme() {
            document.body.classList.toggle("dark");
            localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
        }

        if (localStorage.getItem("theme") === "dark") {
            document.body.classList.add("dark");
        }
    </script>

</body>
</html>
